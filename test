# Script for checking that all files compile

files="binnat function iso control
       path functor monad hedberg discor equiv
       proto proto_pi proto_sigma proto_univ
       iso_example refinement_example
       list nat prelude retract setquot
       pi sigma stream eq either
       coproduct coproduct_noset coproduct_set
       girard puresigma maybenat
       circle quotient om stream paradox lambek
       collection brunerie trunc fun cat
       univalence category grothendieck"
skip="lam"

rm parsed.txt
for file in $files
do
 grep "^import $file$" priv/*.ctt
 cubical -b priv/$file.ctt | tee >(grep Parsed | sed 's|Parsed "priv/||;s|" successfully!||' >>parsed.txt) | grep -vE "0m0|^ *Checking:|^Parsed|File loaded.|^$|cubical, version|shadowed"
done

echo Compiled $(sort -u parsed.txt | wc -l) files of $(ls -1 priv/*.ctt | wc -l) in priv/
echo Skipped files:
join -v2 <(sort -u parsed.txt) <(cd priv && ls -1 *.ctt)
